<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="LabelSpy Demo ‚Äî –∞–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–∞–≤–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–∏—Ç–∞–Ω–∏—è —Å Google Gemini Vision + Tesseract OCR, E-–∫–æ–¥—ã, –∞–ª–ª–µ—Ä–≥–µ–Ω—ã, AI-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞" />
  <meta name="theme-color" content="#0b1320" />
  <title>LabelSpy Demo ‚Äî AI –ê–Ω–∞–ª–∏–∑ —ç—Ç–∏–∫–µ—Ç–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</title>
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><circle cx='96' cy='96' r='90' fill='%232dd4bf'/><text x='96' y='120' font-size='80' font-weight='bold' text-anchor='middle' fill='%230b1320'>L</text></svg>" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="app-header">
    <div class="container">
      <div class="header-row">
        <div class="brand">
          <div class="brand-dot"></div>
          <div>
            <div class="brand-title">LabelSpy ü§ñ</div>
            <div class="brand-subtitle">Demo: AI-–∞–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–∞–≤–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</div>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary" id="btnOpenAbout">‚ÑπÔ∏è –û –ø—Ä–æ–µ–∫—Ç–µ</button>
          <a href="" id="githubLink" class="btn btn-secondary" style="text-decoration: none">‚≠ê GitHub</a>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- OCR & Input Section -->
    <div class="card">
      <h2>üì∏ –®–∞–≥ 1: –ó–∞—Ö–≤–∞—Ç —Å–æ—Å—Ç–∞–≤–∞ (OCR –∏–ª–∏ –≤–≤–æ–¥ –≤—Ä—É—á–Ω—É—é)</h2>
      
      <div class="upload">
        <p class="muted small">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ —ç—Ç–∏–∫–µ—Ç–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∞ –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–∞–≤–∞ –≤—Ä—É—á–Ω—É—é</p>
        <input type="file" id="fileInput" accept="image/*" />
        <div class="upload-help">PNG, JPG, WebP. –î–æ 5 MB. OCR —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–Ω–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä).</div>
      </div>

      <div class="preview-row">
        <div class="preview">
          <img id="imgPreview" alt="preview" />
          <div id="imgPlaceholder" class="placeholder">
            <p class="muted">–ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
          </div>
        </div>
        
        <div class="actions">
          <div class="field">
            <label class="field-label">–Ø–∑—ã–∫ OCR</label>
            <select id="ocrLang">
              <option value="rus">–†—É—Å—Å–∫–∏–π</option>
              <option value="eng">English</option>
              <option value="rus+eng">–†—É—Å—Å–∫–∏–π + English</option>
            </select>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px">
            <button class="btn btn-primary" id="btnOcr" disabled>üîç Tesseract OCR</button>
            <button class="btn btn-secondary" id="btnGeminiOcr" disabled style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white">ü§ñ Gemini Vision</button>
          </div>
          
          <button class="btn btn-secondary" id="btnUseSample" style="margin-top: 8px">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä</button>
          
          <div id="ocrStatus" class="progress hidden">
            <div class="progress-row">
              <span class="muted small">OCR –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ...</span>
            </div>
            <div class="progressbar">
              <div id="ocrBar" class="progressbar-fill"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="field" style="margin-top: 14px">
        <label class="field-label">–¢–µ–∫—Å—Ç —Å–æ—Å—Ç–∞–≤–∞ (–º–æ–∂–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å)</label>
        <textarea class="textarea" id="textInput" placeholder="–°–æ—Å—Ç–∞–≤ –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω —Å—é–¥–∞ –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤—Ä—É—á–Ω—É—é..."></textarea>
        <div class="inline-actions">
          <button class="btn btn-primary" id="btnAnalyze">‚úÖ –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–∞–≤</button>
          <button class="btn btn-secondary" id="btnClear">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
      </div>
    </div>

    <!-- Results Section -->
    <div id="results" class="hidden">
      <div class="card">
        <div class="results-header">
          <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</h2>
          <div class="results-actions">
            <button class="btn btn-secondary" id="btnShareCard">üì• –°–∫–∞—á–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</button>
            <button class="btn btn-secondary" id="btnSaveToHistory">üíæ –í –∏—Å—Ç–æ—Ä–∏—é</button>
          </div>
        </div>

        <!-- AI Analysis Block -->
        <div id="aiAnalysis" class="hidden" style="background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); border-radius: 8px; padding: 16px; margin-bottom: 16px; border: 1px solid #667eea30">
          <div class="pill pill-yellow">‚è≥ –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Å–æ—Å—Ç–∞–≤ —Å –ø–æ–º–æ—â—å—é AI...</div>
        </div>

        <!-- Verdict -->
        <div id="overallVerdict" class="verdict verdict-green">
          <div class="verdict-title" id="overallTitle">–ê–Ω–∞–ª–∏–∑‚Ä¶</div>
          <div class="verdict-body" id="overallBody">–ñ–¥—ë–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤‚Ä¶</div>
          <div class="mini-grid" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 12px">
            <div class="mini-card">
              <div class="mini-title">E-–∫–æ–¥—ã</div>
              <div class="mini-value" id="metricEcodes">0</div>
            </div>
            <div class="mini-card">
              <div class="mini-title">–ê–ª–ª–µ—Ä–≥–µ–Ω—ã</div>
              <div class="mini-value" id="metricAllergens">0</div>
            </div>
            <div class="mini-card">
              <div class="mini-title">–°–∫—Ä—ã—Ç—ã–µ —Å–∞—Ö–∞—Ä–∞</div>
              <div class="mini-value" id="metricSugars">0</div>
            </div>
          </div>
        </div>

        <!-- E-codes Table -->
        <div id="ecodesTable" class="table hidden" style="margin-top: 16px">
          <div style="padding: 10px; text-align: center; color: var(--muted)">–¢–∞–±–ª–∏—Ü–∞ E-–∫–æ–¥–æ–≤</div>
        </div>

        <!-- Allergens -->
        <div id="allergensBlock" class="hidden" style="margin-top: 16px">
          <h3>‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –∞–ª–ª–µ—Ä–≥–µ–Ω—ã</h3>
          <div id="allergensContent" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;"></div>
        </div>

        <!-- Hidden Sugars -->
        <div id="sugarsBlock" class="hidden" style="margin-top: 16px">
          <h3>üç¨ –°–∫—Ä—ã—Ç—ã–µ —Å–∞—Ö–∞—Ä–∞ (—ç–≤—Ä–∏—Å—Ç–∏–∫–∞)</h3>
          <div id="sugarsContent" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;"></div>
        </div>

        <!-- Composition Snippet -->
        <div style="margin-top: 16px">
          <h3>–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Å–æ—Å—Ç–∞–≤</h3>
          <div id="compositionSnippet" class="snippet">‚Äî</div>
        </div>

        <!-- Nutrients & Traffic Light -->
        <div style="margin-top: 16px">
          <h3>üö¶ –°–≤–µ—Ç–æ—Ñ–æ—Ä: –°–∞—Ö–∞—Ä / –ñ–∏—Ä / –°–æ–ª—å (–Ω–∞ 100 –≥)</h3>
          <p class="small muted">–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —ç—Ç–∏–∫–µ—Ç–∫–∏ (–∏–ª–∏ –æ–Ω–∏ —É–∂–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω—ã –≤—ã—à–µ). –¢–∞–±–ª–∏—Ü–∞ –≤–Ω–∏–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ü–µ–Ω–∫—É.</p>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 10px">
            <div class="field">
              <label class="field-label">–°–∞—Ö–∞—Ä (–≥/100–≥)</label>
              <input type="number" id="nutrSugar" placeholder="0" step="0.1" />
            </div>
            <div class="field">
              <label class="field-label">–ñ–∏—Ä (–≥/100–≥)</label>
              <input type="number" id="nutrFat" placeholder="0" step="0.1" />
            </div>
            <div class="field">
              <label class="field-label">–°–æ–ª—å (–≥/100–≥)</label>
              <input type="number" id="nutrSalt" placeholder="0" step="0.1" />
            </div>
          </div>
          
          <button class="btn btn-primary" id="btnRecalc" style="margin-top: 10px">–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å —Å–≤–µ—Ç–æ—Ñ–æ—Ä</button>

          <div class="traffic" style="margin-top: 16px">
            <div class="traffic-item">
              <div class="traffic-label">–°–∞—Ö–∞—Ä</div>
              <div id="tlSugar" class="pill pill-unknown">‚Äî</div>
            </div>
            <div class="traffic-item">
              <div class="traffic-label">–ñ–∏—Ä</div>
              <div id="tlFat" class="pill pill-unknown">‚Äî</div>
            </div>
            <div class="traffic-item">
              <div class="traffic-label">–°–æ–ª—å</div>
              <div id="tlSalt" class="pill pill-unknown">‚Äî</div>
            </div>
          </div>
        </div>
      </div>

      <!-- History -->
      <div id="historyBlock" class="card hidden">
        <h2>üìú –ò—Å—Ç–æ—Ä–∏—è –∞–Ω–∞–ª–∏–∑–æ–≤</h2>
        <div id="historyContent" style="display: flex; flex-direction: column; gap: 10px"></div>
      </div>
    </div>

    <!-- About Dialog -->
    <dialog id="aboutDialog" class="dialog">
      <form method="dialog">
        <h2>–û LabelSpy Demo</h2>
        <p>–≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–æ—Ç–æ—Ç–∏–ø –≤–µ–±‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å–æ—Å—Ç–∞–≤–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–∏—Ç–∞–Ω–∏—è:</p>
        <ul style="color: var(--muted)">
          <li><strong>Dual OCR</strong>: Tesseract.js (–≤ –±—Ä–∞—É–∑–µ—Ä–µ) + <strong>Google Gemini Vision API</strong> (–∏–¥–µ–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ).</li>
          <li><strong>AI-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞</strong> —Å –ø–æ–º–æ—â—å—é Gemini: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ—Å—Ç–∞–≤–∞.</li>
          <li><strong>E‚Äë–∫–æ–¥—ã</strong> –∏—â—É—Ç—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –¥–µ–º–æ‚Äë–±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.</li>
          <li><strong>–ê–ª–ª–µ—Ä–≥–µ–Ω—ã</strong> –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ –ø—Ä–æ—Å—Ç—ã–º —ç–≤—Ä–∏—Å—Ç–∏–∫–∞–º.</li>
          <li><strong>–°–≤–µ—Ç–æ—Ñ–æ—Ä</strong> –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å —Å–∞—Ö–∞—Ä–∞/–∂–∏—Ä–∞/—Å–æ–ª–∏ –Ω–∞ 100 –≥.</li>
          <li><strong>PWA</strong> —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω (–∫–µ—à–∏—Ä—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã).</li>
        </ul>
        <p class="small muted" style="margin-top: 14px">
          <strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong> —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–æ—Å—è—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π. –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —ç—Ç–∏–∫–µ—Ç–∫—É.
        </p>
        <div class="dialog-actions">
          <button class="btn btn-primary">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
      </form>
    </dialog>

    <!-- Footer -->
    <div class="footer">
      <details class="tips" open>
        <summary><strong>üí° –°–æ–≤–µ—Ç—ã</strong></summary>
        <ul>
          <li>ü§ñ <strong>Gemini Vision OCR</strong> ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ Google AI (99% —Ç–æ—á–Ω–æ—Å—Ç—å).</li>
          <li>üîç <strong>Tesseract OCR</strong> ‚Äî –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–±–µ–∑ API).</li>
          <li>–•–æ—Ä–æ—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ —Ñ–æ—Ç–æ —ç—Ç–∏–∫–µ—Ç–∫–∏ —É–ª—É—á—à–∏—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ OCR.</li>
          <li>–ï—Å–ª–∏ OCR –æ—à–∏–±—Å—è ‚Äî –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é –≤ –ø–æ–ª–µ –≤—ã—à–µ.</li>
          <li>–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (localStorage).</li>
          <li><a href="https://github.com/codgorbachev-art/labelspy-demo" target="_blank" rel="noopener noreferrer">GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π</a></li>
        </ul>
      </details>
      <p style="margin-top: 14px">LabelSpy Demo ‚Ä¢ MIT License ‚Ä¢ v0.2.0 + Gemini AI</p>
    </div>
  </div>

  <script>
    // Register service worker for PWA
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js').catch(err => console.warn('SW:', err));
    }
    // Set repo link
    window.__LABELSPY_REPO = 'codgorbachev-art/labelspy-demo';
  </script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script src="./app.js"></script>
</body>
</html>