<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="LabelSpy 2.0 ‚Äî AI-–∞–Ω–∞–ª–∏–∑ –ø–∏—â–µ–≤—ã—Ö —ç—Ç–∏–∫–µ—Ç–æ–∫ —Å Tesseract OCR –∏ Google Gemini. –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞, E-–∫–æ–¥—ã, –∞–ª–ª–µ—Ä–≥–µ–Ω—ã, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤" />
  <meta name="theme-color" content="#0b1320" />
  <title>LabelSpy 2.0 ‚Äî AI –ê–Ω–∞–ª–∏–∑ –≠—Ç–∏–∫–µ—Ç–æ–∫</title>
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><circle cx='96' cy='96' r='90' fill='%2360a5fa'/><text x='96' y='130' font-size='90' font-weight='bold' text-anchor='middle' fill='%230b1320'>üîç</text></svg>" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="app-header">
    <div class="container">
      <div class="header-row">
        <div class="brand">
          <div class="brand-dot"></div>
          <div>
            <div class="brand-title">LabelSpy 2.0 ü§ñ</div>
            <div class="brand-subtitle">AI-–∞–Ω–∞–ª–∏–∑ –ø–∏—â–µ–≤—ã—Ö —ç—Ç–∏–∫–µ—Ç–æ–∫</div>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary" id="btnOpenAbout">‚ÑπÔ∏è –û –ø—Ä–æ–µ–∫—Ç–µ</button>
          <a href="" id="githubLink" class="btn btn-secondary" style="text-decoration: none">‚≠ê GitHub</a>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- OCR & Input Section -->
    <div class="card glass-card">
      <h2>üì∏ –®–∞–≥ 1: –ó–∞—Ö–≤–∞—Ç —Å–æ—Å—Ç–∞–≤–∞</h2>
      
      <div class="upload">
        <p class="muted small">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ —ç—Ç–∏–∫–µ—Ç–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∞ –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–∞–≤–∞ –≤—Ä—É—á–Ω—É—é</p>
        <input type="file" id="fileInput" accept="image/*" />
        <div class="upload-help">PNG, JPG, WebP. –î–æ 5 MB. <strong>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è Tesseract OCR</strong> (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ –±–µ–∑ API).</div>
      </div>

      <div class="preview-row">
        <div class="preview">
          <img id="imgPreview" alt="preview" />
          <div id="imgPlaceholder" class="placeholder">
            <p class="muted">–ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
          </div>
        </div>
        
        <div class="actions">
          <div class="field">
            <label class="field-label">–Ø–∑—ã–∫ OCR</label>
            <select id="ocrLang">
              <option value="rus">–†—É—Å—Å–∫–∏–π</option>
              <option value="eng">English</option>
              <option value="rus+eng" selected>–†—É—Å—Å–∫–∏–π + English</option>
            </select>
          </div>
          
          <div class="ocr-buttons">
            <button class="btn btn-primary" id="btnOcr" disabled>
              <span class="btn-icon">üîç</span>
              <span>Tesseract OCR</span>
            </button>
            <button class="btn btn-gemini" id="btnGeminiOcr" disabled title="‚ö†Ô∏è –ú–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑-–∑–∞ CORS. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Tesseract.">
              <span class="btn-icon">ü§ñ</span>
              <span>Gemini Vision</span>
            </button>
          </div>
          
          <div class="info-box">
            <span class="info-icon">‚ÑπÔ∏è</span>
            <span class="info-text"><strong>Tesseract OCR</strong> ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ. <br><strong>Gemini</strong> ‚Äî –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –±—Ä–∞—É–∑–µ—Ä–æ–º (CORS).</span>
          </div>
          
          <button class="btn btn-secondary" id="btnUseSample">üìã –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä</button>
          
          <div id="ocrStatus" class="progress hidden">
            <div class="progress-row">
              <span class="muted small">OCR –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ...</span>
            </div>
            <div class="progressbar">
              <div id="ocrBar" class="progressbar-fill"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="field" style="margin-top: 14px">
        <label class="field-label">–¢–µ–∫—Å—Ç —Å–æ—Å—Ç–∞–≤–∞ (–º–æ–∂–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å)</label>
        <textarea class="textarea" id="textInput" placeholder="–°–æ—Å—Ç–∞–≤ –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω —Å—é–¥–∞ –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤—Ä—É—á–Ω—É—é..."></textarea>
        <div class="inline-actions">
          <button class="btn btn-primary btn-lg" id="btnAnalyze">
            <span class="btn-icon">‚ú®</span>
            <span>–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Å—Ç–∞–≤</span>
          </button>
          <button class="btn btn-secondary" id="btnClear">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
      </div>
    </div>

    <!-- Results Section -->
    <div id="results" class="hidden">
      <div class="card glass-card">
        <div class="results-header">
          <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</h2>
          <div class="results-actions">
            <button class="btn btn-gemini" id="btnGenerateCard">
              <span class="btn-icon">üé®</span>
              <span>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É AI</span>
            </button>
            <button class="btn btn-secondary" id="btnCompare">üîÑ –î–æ–±–∞–≤–∏—Ç—å –≤ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ</button>
            <button class="btn btn-secondary" id="btnSaveToHistory">üíæ –í –∏—Å—Ç–æ—Ä–∏—é</button>
          </div>
        </div>

        <!-- AI Analysis Block -->
        <div id="aiAnalysis" class="hidden ai-analysis-card">
          <div class="pill pill-yellow">‚è≥ –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Å–æ—Å—Ç–∞–≤ —Å –ø–æ–º–æ—â—å—é AI...</div>
        </div>

        <!-- Verdict -->
        <div id="overallVerdict" class="verdict verdict-green">
          <div class="verdict-title" id="overallTitle">–ê–Ω–∞–ª–∏–∑‚Ä¶</div>
          <div class="verdict-body" id="overallBody">–ñ–¥—ë–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤‚Ä¶</div>
          <div class="mini-grid">
            <div class="mini-card">
              <div class="mini-icon">üß™</div>
              <div class="mini-title">E-–∫–æ–¥—ã</div>
              <div class="mini-value" id="metricEcodes">0</div>
            </div>
            <div class="mini-card">
              <div class="mini-icon">‚ö†Ô∏è</div>
              <div class="mini-title">–ê–ª–ª–µ—Ä–≥–µ–Ω—ã</div>
              <div class="mini-value" id="metricAllergens">0</div>
            </div>
            <div class="mini-card">
              <div class="mini-icon">üç≠</div>
              <div class="mini-title">–°–∫—Ä. —Å–∞—Ö–∞—Ä–∞</div>
              <div class="mini-value" id="metricSugars">0</div>
            </div>
          </div>
        </div>

        <!-- E-codes Table -->
        <div id="ecodesTable" class="table hidden"></div>

        <!-- Allergens -->
        <div id="allergensBlock" class="hidden alert-block">
          <h3>‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –∞–ª–ª–µ—Ä–≥–µ–Ω—ã</h3>
          <div id="allergensContent" class="pills-row"></div>
        </div>

        <!-- Hidden Sugars -->
        <div id="sugarsBlock" class="hidden alert-block">
          <h3>üç¨ –°–∫—Ä—ã—Ç—ã–µ —Å–∞—Ö–∞—Ä–∞</h3>
          <div id="sugarsContent" class="pills-row"></div>
        </div>

        <!-- Composition Snippet -->
        <div class="composition-block">
          <h3>üìã –†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Å–æ—Å—Ç–∞–≤</h3>
          <div id="compositionSnippet" class="snippet">‚Äî</div>
        </div>

        <!-- Nutrients & Traffic Light -->
        <div class="nutrients-section">
          <h3>üö¶ –°–≤–µ—Ç–æ—Ñ–æ—Ä: –°–∞—Ö–∞—Ä / –ñ–∏—Ä / –°–æ–ª—å</h3>
          <p class="small muted">–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —ç—Ç–∏–∫–µ—Ç–∫–∏ (–∏–ª–∏ –æ–Ω–∏ —É–∂–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω—ã).</p>
          
          <div class="nutrients-grid">
            <div class="field">
              <label class="field-label">üç≠ –°–∞—Ö–∞—Ä (–≥/100–≥)</label>
              <input type="number" id="nutrSugar" placeholder="0" step="0.1" />
            </div>
            <div class="field">
              <label class="field-label">üßà –ñ–∏—Ä (–≥/100–≥)</label>
              <input type="number" id="nutrFat" placeholder="0" step="0.1" />
            </div>
            <div class="field">
              <label class="field-label">üßÇ –°–æ–ª—å (–≥/100–≥)</label>
              <input type="number" id="nutrSalt" placeholder="0" step="0.1" />
            </div>
          </div>
          
          <button class="btn btn-primary" id="btnRecalc">‚ôªÔ∏è –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å</button>

          <div class="traffic">
            <div class="traffic-item">
              <div class="traffic-label">üç≠ –°–∞—Ö–∞—Ä</div>
              <div id="tlSugar" class="pill pill-unknown">‚Äî</div>
            </div>
            <div class="traffic-item">
              <div class="traffic-label">üßà –ñ–∏—Ä</div>
              <div id="tlFat" class="pill pill-unknown">‚Äî</div>
            </div>
            <div class="traffic-item">
              <div class="traffic-label">üßÇ –°–æ–ª—å</div>
              <div id="tlSalt" class="pill pill-unknown">‚Äî</div>
            </div>
          </div>
        </div>
      </div>

      <!-- History -->
      <div id="historyBlock" class="card glass-card hidden">
        <h2>üìú –ò—Å—Ç–æ—Ä–∏—è –∞–Ω–∞–ª–∏–∑–æ–≤</h2>
        <div id="historyContent" class="history-list"></div>
      </div>
    </div>

    <!-- About Dialog -->
    <dialog id="aboutDialog" class="dialog">
      <form method="dialog">
        <h2>üîç –û LabelSpy 2.0</h2>
        <p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è AI-–∞–Ω–∞–ª–∏–∑–∞ –ø–∏—â–µ–≤—ã—Ö —ç—Ç–∏–∫–µ—Ç–æ–∫:</p>
        <ul class="feature-list">
          <li>üîç <strong>Tesseract OCR</strong> ‚Äî –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</li>
          <li>ü§ñ <strong>Google Gemini Vision API</strong> ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ (–º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑-–∑–∞ CORS)</li>
          <li>üß≠ <strong>AI-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞</strong> ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ—Å—Ç–∞–≤–∞</li>
          <li>üé® <strong>–ö—Ä–∞—Å–∏–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏</strong> ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Gemini API</li>
          <li>üîÑ <strong>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</strong> ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ 5 –ø—Ä–æ–¥—É–∫—Ç–æ–≤</li>
          <li>üß™ <strong>E-–∫–æ–¥—ã</strong> ‚Äî –ª–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</li>
          <li>üö¶ <strong>–°–≤–µ—Ç–æ—Ñ–æ—Ä</strong> ‚Äî —Å–∞—Ö–∞—Ä/–∂–∏—Ä/—Å–æ–ª—å –Ω–∞ 100 –≥</li>
          <li>üíæ <strong>–ò—Å—Ç–æ—Ä–∏—è</strong> ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ 20 –∞–Ω–∞–ª–∏–∑–æ–≤</li>
          <li>‚ú® <strong>PWA</strong> ‚Äî —Ä–∞–±–æ—Ç–∞ –æ—Ñ–ª–∞–π–Ω</li>
        </ul>
        <div class="warning-box">
          <strong>‚ö†Ô∏è –í–∞–∂–Ω–æ –ø—Ä–æ CORS:</strong><br>
Gemini API –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –±—Ä–∞—É–∑–µ—Ä–æ–º –∏–∑-–∑–∞ CORS-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å <strong>Tesseract OCR</strong>, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
        </div>
        <p class="small muted disclaimer">
          <strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong> –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–æ—Å—è—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä. –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —ç—Ç–∏–∫–µ—Ç–∫—É.
        </p>
        <div class="dialog-actions">
          <button class="btn btn-primary">‚úÖ –ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
      </form>
    </dialog>

    <!-- Footer -->
    <div class="footer">
      <details class="tips" open>
        <summary><strong>üí° –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LabelSpy 2.0</strong></summary>
        <ul>
          <li>üîç <strong>Tesseract OCR</strong> (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) ‚Äî –±—ã—Å—Ç—Ä–æ–µ –æ—Ñ–ª–∞–π–Ω —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ</li>
          <li>ü§ñ <strong>Gemini Vision</strong> ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ (–º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å –∏–∑-–∑–∞ CORS)</li>
          <li>üé® <strong>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫</strong> ‚Äî –∫—Ä–∞—Å–∏–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π</li>
          <li>üîÑ <strong>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ</strong> ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ –¥–æ 5 –ø—Ä–æ–¥—É–∫—Ç–æ–≤</li>
          <li>üíæ <strong>–ò—Å—Ç–æ—Ä–∏—è</strong> ‚Äî –≤—Å–µ –≤–∞—à–∏ –∞–Ω–∞–ª–∏–∑—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ</li>
          <li>üì± <strong>PWA</strong> ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω</li>
        </ul>
      </details>
      <div class="footer-links">
        <a href="https://github.com/codgorbachev-art/labelspy-demo" target="_blank" rel="noopener noreferrer">‚≠ê GitHub</a>
        <span>‚Ä¢</span>
        <a href="https://ai.google.dev/gemini-api" target="_blank" rel="noopener noreferrer">ü§ñ Gemini API</a>
        <span>‚Ä¢</span>
        <span class="muted">v2.0.1</span>
      </div>
      <p class="footer-copyright">LabelSpy 2.0 ‚Ä¢ MIT License ‚Ä¢ Powered by Tesseract & Gemini AI</p>
    </div>
  </div>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js').catch(err => console.warn('SW:', err));
    }
    window.__LABELSPY_REPO = 'codgorbachev-art/labelspy-demo';
  </script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="./app.js"></script>
</body>
</html>