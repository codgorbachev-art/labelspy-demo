<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="description" content="LabelSpy 3.0 ‚Äî AI-–∞–Ω–∞–ª–∏–∑ –ø–∏—â–µ–≤—ã—Ö —ç—Ç–∏–∫–µ—Ç–æ–∫. Gemini Vision OCR 99%, —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –†–æ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ CORS Proxy" />
  <meta name="theme-color" content="#0b1320" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>LabelSpy 3.0 ‚Äî AI –ê–Ω–∞–ª–∏–∑ –≠—Ç–∏–∫–µ—Ç–æ–∫</title>
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><circle cx='96' cy='96' r='90' fill='%2360a5fa'/><text x='96' y='130' font-size='90' font-weight='bold' text-anchor='middle' fill='%230b1320'>üîç</text></svg>" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="app-header">
    <div class="container">
      <div class="header-row">
        <div class="brand">
          <div class="brand-dot"></div>
          <div>
            <div class="brand-title">LabelSpy 3.0</div>
            <div class="brand-subtitle">AI-–∞–Ω–∞–ª–∏–∑ —ç—Ç–∏–∫–µ—Ç–æ–∫</div>
          </div>
        </div>
        <div class="header-actions">
          <button class="btn btn-secondary btn-sm" id="btnOpenAbout">‚ÑπÔ∏è</button>
          <a href="" id="githubLink" class="btn btn-secondary btn-sm" style="text-decoration: none">‚≠ê</a>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- OCR & Input -->
    <div class="card glass-card">
      <h2>üì∏ –ó–∞—Ö–≤–∞—Ç —Å–æ—Å—Ç–∞–≤–∞</h2>
      
      <div class="upload">
        <p class="muted small">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ —ç—Ç–∏–∫–µ—Ç–∫–∏</p>
        <input type="file" id="fileInput" accept="image/*" capture="environment" />
        <div class="upload-help">üåê <strong>Gemini —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –†–§</strong> —á–µ—Ä–µ–∑ Multi-Proxy!</div>
      </div>

      <div class="preview-row">
        <div class="preview">
          <img id="imgPreview" alt="preview" />
          <div id="imgPlaceholder" class="placeholder">
            <p class="muted">–ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
          </div>
        </div>
        
        <div class="actions">
          <button class="btn btn-secondary btn-block" id="btnUseSample">üìã –ü—Ä–∏–º–µ—Ä</button>
          
          <div class="field">
            <label class="field-label">–Ø–∑—ã–∫ OCR</label>
            <select id="ocrLang">
              <option value="rus">–†—É—Å—Å–∫–∏–π</option>
              <option value="eng">English</option>
              <option value="rus+eng" selected>–†—É—Å—Å–∫–∏–π + English</option>
            </select>
          </div>
          
          <div class="ocr-buttons">
            <button class="btn btn-primary" id="btnOcr" disabled>
              <span class="btn-icon">üîç</span>
              <span>Tesseract</span>
            </button>
            <button class="btn btn-gemini" id="btnGeminiOcr" disabled>
              <span class="btn-icon">ü§ñ</span>
              <span>Gemini</span>
            </button>
          </div>
          
          <div class="info-box-compact">
            üîç <strong>Tesseract</strong> ‚Äî –±—ã—Å—Ç—Ä—ã–π<br>
            ü§ñ <strong>Gemini</strong> ‚Äî —Ç–æ—á–Ω—ã–π (99%)
          </div>
          
          <div id="ocrStatus" class="progress hidden">
            <div class="progress-row">
              <span class="muted small">OCR...</span>
            </div>
            <div class="progressbar">
              <div id="ocrBar" class="progressbar-fill"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="field" style="margin-top: 14px">
        <label class="field-label">–¢–µ–∫—Å—Ç —Å–æ—Å—Ç–∞–≤–∞</label>
        <textarea class="textarea" id="textInput" placeholder="–°–æ—Å—Ç–∞–≤ –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω —Å—é–¥–∞..."></textarea>
        <div class="inline-actions">
          <button class="btn btn-primary btn-lg" id="btnAnalyze">
            <span class="btn-icon">‚ú®</span>
            <span>–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</span>
          </button>
          <button class="btn btn-secondary" id="btnClear">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
      </div>
    </div>

    <!-- Results -->
    <div id="results" class="hidden">
      <div class="card glass-card">
        <div class="results-header">
          <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
          <div class="results-actions">
            <button class="btn btn-secondary btn-sm" id="btnGeneratePDF">üìÑ PDF</button>
            <button class="btn btn-secondary btn-sm" id="btnCompare">üîÑ</button>
            <button class="btn btn-secondary btn-sm" id="btnSaveToHistory">üíæ</button>
          </div>
        </div>

        <!-- AI Analysis -->
        <div id="aiAnalysis" class="hidden ai-analysis-card"></div>

        <!-- Verdict -->
        <div id="overallVerdict" class="verdict verdict-green">
          <div class="verdict-title" id="overallTitle">–ê–Ω–∞–ª–∏–∑‚Ä¶</div>
          <div class="verdict-body" id="overallBody">–ñ–¥—ë–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤‚Ä¶</div>
          <div class="mini-grid">
            <div class="mini-card">
              <div class="mini-icon">üß™</div>
              <div class="mini-title">E-–∫–æ–¥—ã</div>
              <div class="mini-value" id="metricEcodes">0</div>
            </div>
            <div class="mini-card">
              <div class="mini-icon">‚ö†Ô∏è</div>
              <div class="mini-title">–ê–ª–ª–µ—Ä–≥–µ–Ω—ã</div>
              <div class="mini-value" id="metricAllergens">0</div>
            </div>
            <div class="mini-card">
              <div class="mini-icon">üç≠</div>
              <div class="mini-title">–°–∞—Ö–∞—Ä–∞</div>
              <div class="mini-value" id="metricSugars">0</div>
            </div>
          </div>
        </div>

        <!-- E-codes -->
        <div id="ecodesTable" class="table hidden"></div>

        <!-- Allergens -->
        <div id="allergensBlock" class="hidden alert-block">
          <h3>‚ö†Ô∏è –ê–ª–ª–µ—Ä–≥–µ–Ω—ã</h3>
          <div id="allergensContent" class="pills-row"></div>
        </div>

        <!-- Sugars -->
        <div id="sugarsBlock" class="hidden alert-block">
          <h3>üç¨ –°–∫—Ä—ã—Ç—ã–µ —Å–∞—Ö–∞—Ä–∞</h3>
          <div id="sugarsContent" class="pills-row"></div>
        </div>

        <!-- Composition -->
        <div class="composition-block">
          <h3>üìã –°–æ—Å—Ç–∞–≤</h3>
          <div id="compositionSnippet" class="snippet">‚Äî</div>
        </div>

        <!-- Nutrients -->
        <div class="nutrients-section">
          <h3>üö¶ –°–≤–µ—Ç–æ—Ñ–æ—Ä</h3>
          
          <div class="nutrients-grid">
            <div class="field">
              <label class="field-label">–°–∞—Ö–∞—Ä (–≥/100–≥)</label>
              <input type="number" id="nutrSugar" placeholder="0" step="0.1" />
            </div>
            <div class="field">
              <label class="field-label">–ñ–∏—Ä (–≥/100–≥)</label>
              <input type="number" id="nutrFat" placeholder="0" step="0.1" />
            </div>
            <div class="field">
              <label class="field-label">–°–æ–ª—å (–≥/100–≥)</label>
              <input type="number" id="nutrSalt" placeholder="0" step="0.1" />
            </div>
          </div>
          
          <button class="btn btn-primary btn-block" id="btnRecalc">‚ôªÔ∏è –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å</button>

          <div class="traffic">
            <div class="traffic-item">
              <div class="traffic-label">–°–∞—Ö–∞—Ä</div>
              <div id="tlSugar" class="pill pill-unknown">‚Äî</div>
            </div>
            <div class="traffic-item">
              <div class="traffic-label">–ñ–∏—Ä</div>
              <div id="tlFat" class="pill pill-unknown">‚Äî</div>
            </div>
            <div class="traffic-item">
              <div class="traffic-label">–°–æ–ª—å</div>
              <div id="tlSalt" class="pill pill-unknown">‚Äî</div>
            </div>
          </div>
        </div>
      </div>

      <!-- History -->
      <div id="historyBlock" class="card glass-card hidden">
        <h2>üìú –ò—Å—Ç–æ—Ä–∏—è</h2>
        <div id="historyContent" class="history-list"></div>
      </div>
    </div>

    <!-- About -->
    <dialog id="aboutDialog" class="dialog">
      <form method="dialog">
        <h2>üîç LabelSpy 3.0</h2>
        <p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π AI-–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –ø–∏—â–µ–≤—ã—Ö —ç—Ç–∏–∫–µ—Ç–æ–∫ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Google Gemini AI.</p>
        <ul class="feature-list">
          <li>üîç <strong>Tesseract OCR</strong> ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–π, –±—ã—Å—Ç—Ä—ã–π</li>
          <li>ü§ñ <strong>Gemini Vision</strong> ‚Äî 99% —Ç–æ—á–Ω–æ—Å—Ç—å</li>
          <li>üåê <strong>Multi-Proxy</strong> ‚Äî —Ä–∞–±–æ—Ç–∞ –∏–∑ –†–æ—Å—Å–∏–∏</li>
          <li>üß≠ <strong>AI-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞</strong> ‚Äî —É–º–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</li>
          <li>üìÑ <strong>PDF-–æ—Ç—á–µ—Ç—ã</strong> ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ</li>
          <li>üö¶ <strong>–°–≤–µ—Ç–æ—Ñ–æ—Ä</strong> ‚Äî —Å–∞—Ö–∞—Ä/–∂–∏—Ä/—Å–æ–ª—å</li>
          <li>üíæ <strong>–ò—Å—Ç–æ—Ä–∏—è</strong> ‚Äî 20 –∞–Ω–∞–ª–∏–∑–æ–≤</li>
          <li>üîÑ <strong>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ</strong> ‚Äî 5 –ø—Ä–æ–¥—É–∫—Ç–æ–≤</li>
          <li>üì± <strong>PWA</strong> ‚Äî –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º</li>
        </ul>
        <div class="warning-box">
          <strong>üåê CORS Proxy:</strong><br>
          –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 4 proxy –¥–ª—è —Ä–∞–±–æ—Ç—ã Gemini API –∏–∑ –†–æ—Å—Å–∏–∏. –ï—Å–ª–∏ –æ–¥–∏–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–æ–π.
        </div>
        <div class="dialog-actions">
          <button class="btn btn-primary">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
      </form>
    </dialog>

    <!-- Footer -->
    <div class="footer">
      <details class="tips">
        <summary><strong>üí° –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</strong></summary>
        <ol>
          <li>üì∏ –ó–∞–≥—Ä—É–∑–∏ —Ñ–æ—Ç–æ —ç—Ç–∏–∫–µ—Ç–∫–∏</li>
          <li>ü§ñ –ù–∞–∂–º–∏ <strong>Gemini</strong> –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ OCR</li>
          <li>‚ú® <strong>–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</strong> ‚Äî –ø–æ–ª—É—á–∏ AI-–æ—Ü–µ–Ω–∫—É</li>
          <li>üìÑ <strong>PDF</strong> ‚Äî —Å–∫–∞—á–∞–π –æ—Ç—á–µ—Ç</li>
        </ol>
      </details>
      <div class="footer-links">
        <a href="https://github.com/codgorbachev-art/labelspy-demo">‚≠ê GitHub</a>
        <span>‚Ä¢</span>
        <span class="muted">v3.0.0</span>
      </div>
      <p class="footer-copyright">LabelSpy 3.0 ‚Ä¢ Powered by Tesseract & Gemini AI</p>
    </div>
  </div>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js').catch(err => console.warn('SW:', err));
    }
    window.__LABELSPY_REPO = 'codgorbachev-art/labelspy-demo';
  </script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="./app.js"></script>
</body>
</html>